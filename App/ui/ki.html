<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #0b0e14; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .header { padding: 20px; border-bottom: 1px solid #1a1d26; display: flex; align-items: center; }
        .chat-container { flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 12px 18px; border-radius: 15px; max-width: 80%; line-height: 1.5; font-size: 14px; }
        .user { background: #1c212b; align-self: flex-end; border-bottom-right-radius: 2px; border: 1px solid #333; }
        .ai { background: rgba(0, 242, 255, 0.1); align-self: flex-start; border-bottom-left-radius: 2px; border: 1px solid #00f2ff; color: #00f2ff; }
        .input-box { padding: 20px; background: #0f111a; display: flex; gap: 10px; }
        input { flex-grow: 1; background: #0b0e14; border: 1px solid #333; color: white; padding: 12px; border-radius: 8px; outline: none; }
        button { background: #00f2ff; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .loading { font-style: italic; opacity: 0.5; font-size: 12px; }
    </style>
</head>
<body>
    <div class="header">
        <i class="fas fa-arrow-left" onclick="ipcRenderer.send('nav-to', 'tabs')" style="cursor:pointer; margin-right:15px"></i>
        <span>NEON FREE AI</span>
    </div>
    <div class="chat-container" id="chat">
        <div class="msg ai">Hallo Joel! Ich bin deine kostenlose NEON KI. Wie kann ich helfen?</div>
    </div>
    <div class="input-box">
        <input type="text" id="in" placeholder="Frage stellen oder Website-URL zur Analyse einfÃ¼gen...">
        <button onclick="ask()">SENDEN</button>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        async function ask() {
            const input = document.getElementById('in');
            const chat = document.getElementById('chat');
            const text = input.value;
            if(!text) return;

            // User Nachricht anzeigen
            chat.innerHTML += `<div class="msg user">${text}</div>`;
            input.value = "";
            
            // Loading
            const loadId = "load-" + Date.now();
            chat.innerHTML += `<div class="msg ai loading" id="${loadId}">NEON KI denkt nach...</div>`;
            chat.scrollTop = chat.scrollHeight;

            // Ist es eine URL?
            const isUrl = text.includes("http") || (text.includes(".") && !text.includes(" "));
            const channel = isUrl ? 'analyze-website' : 'send-ai-request';

            const response = await ipcRenderer.invoke(channel, text);
            
            document.getElementById(loadId).remove();
            chat.innerHTML += `<div class="msg ai">${response.replace(/\n/g, '<br>')}</div>`;
            chat.scrollTop = chat.scrollHeight;
        }
    </script>
</body>
</html>