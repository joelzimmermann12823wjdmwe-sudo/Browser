<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0b0e14; --side: #0f111a; --acc: #00f2ff; --text: #fff; }
        body.light-mode { --bg: #f0f0f0; --side: #ddd; --acc: #0078d4; --text: #000; }
        
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 65px; background: var(--side); display: flex; flex-direction: column; align-items: center; padding: 20px 0; border-right: 1px solid rgba(255,255,255,0.05); -webkit-app-region: drag; }
        .side-icon { font-size: 20px; color: #4a4d5e; margin-bottom: 25px; cursor: pointer; transition: 0.3s; -webkit-app-region: no-drag; }
        .side-icon:hover, .side-icon.active { color: var(--acc); transform: scale(1.1); }
        
        .spacer { flex-grow: 1; } /* Schiebt alles danach nach unten */

        .main { flex-grow: 1; display: flex; flex-direction: column; }
        .navbar { height: 45px; display: flex; align-items: center; padding: 0 15px; -webkit-app-region: drag; }
        .url-bar { flex-grow: 1; background: rgba(255,255,255,0.05); border-radius: 20px; padding: 5px 15px; margin: 0 15px; -webkit-app-region: no-drag; display: flex; }
        .url-bar input { background: transparent; border: none; color: var(--text); width: 100%; outline: none; }
        
        webview { flex-grow: 1; background: white; }

        #update-bar { display: none; position: absolute; top: 50px; right: 20px; background: #151921; padding: 15px; border-radius: 8px; border: 1px solid var(--acc); z-index: 100; }
    </style>
</head>
<body id="body">

    <div class="sidebar">
        <div class="side-icon" onclick="wv.reload()"><i class="fas fa-home"></i></div>
        <div class="side-icon" onclick="ipcRenderer.send('nav-to', 'ki')"><i class="fas fa-robot"></i></div>
        
        <div class="spacer"></div> <div id="upd-icon" class="side-icon" style="display:none; color:#00ff88" onclick="showUpdate()"><i class="fas fa-arrow-alt-circle-up"></i></div>
        <div class="side-icon" onclick="ipcRenderer.send('nav-to', 'settings')"><i class="fas fa-cog"></i></div>
    </div>

    <div class="main">
        <div class="navbar">
            <div class="url-bar"><input type="text" id="ui" placeholder="Suchen oder URL eingeben..."></div>
            <div style="-webkit-app-region: no-drag;">
                <i class="fas fa-minus" onclick="ipcRenderer.send('window-control', 'minimize')" style="cursor:pointer; margin-right:15px"></i>
                <i class="fas fa-times" onclick="ipcRenderer.send('window-control', 'close')" style="cursor:pointer; color:#ff4444"></i>
            </div>
        </div>
        <webview id="wv" src="https://www.google.com"></webview>
    </div>

    <div id="update-bar">
        <small id="upd-text">Update wird geladen...</small>
        <button id="btn-re" style="display:none; margin-top:10px" onclick="ipcRenderer.send('restart_app')">Neustarten</button>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        const wv = document.getElementById('wv');
        const ui = document.getElementById('ui');

        // Theme & Search Engine laden
        if(localStorage.getItem('theme') === 'light') document.getElementById('body').classList.add('light-mode');
        
        ui.addEventListener('keydown', (e) => {
            if(e.key === 'Enter') {
                let v = ui.value;
                let engine = localStorage.getItem('engine') || 'https://google.com/search?q=';
                if(!v.includes('.') || v.includes(' ')) wv.loadURL(engine + encodeURIComponent(v));
                else { if(!v.startsWith('http')) v = 'https://' + v; wv.loadURL(v); }
            }
        });

        // Updater
        ipcRenderer.on('update_available', () => document.getElementById('upd-icon').style.display = 'block');
        ipcRenderer.on('update_downloaded', () => {
            document.getElementById('update-bar').style.display = 'block';
            document.getElementById('upd-text').innerText = "Update fertig!";
            document.getElementById('btn-re').style.display = 'block';
        });
        wv.addEventListener('did-navigate', (e) => ui.value = e.url);
    </script>
</body>
</html>